<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />



  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.3">







  <meta name="keywords" content="tibbletime,time series," />










<meta name="description" content="tibbletime是Business Science团队推出的一款与tidyverse框架完美契合的时序数据包。tibbletime提供了一种新的时序数据类型——tbl_time，其继承了R中数据框的data.frame类以及tibble包中的tbl_df类，与dplyr这一数据处理利器完美契合。同时，tibbletime还提供了一系列强大的函数用以处理tbl_time类型的数据。tibblet">
<meta name="keywords" content="tibbletime,time series">
<meta property="og:type" content="article">
<meta property="og:title" content="tibbletime包：时序数据处理的倚天剑">
<meta property="og:url" content="http://yoursite.com/2018/01/06/tibbletime包：时序数据处理的倚天剑/index.html">
<meta property="og:site_name" content="Leo Lee">
<meta property="og:description" content="tibbletime是Business Science团队推出的一款与tidyverse框架完美契合的时序数据包。tibbletime提供了一种新的时序数据类型——tbl_time，其继承了R中数据框的data.frame类以及tibble包中的tbl_df类，与dplyr这一数据处理利器完美契合。同时，tibbletime还提供了一系列强大的函数用以处理tbl_time类型的数据。tibblet">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-01-06T09:58:19.327Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="tibbletime包：时序数据处理的倚天剑">
<meta name="twitter:description" content="tibbletime是Business Science团队推出的一款与tidyverse框架完美契合的时序数据包。tibbletime提供了一种新的时序数据类型——tbl_time，其继承了R中数据框的data.frame类以及tibble包中的tbl_df类，与dplyr这一数据处理利器完美契合。同时，tibbletime还提供了一系列强大的函数用以处理tbl_time类型的数据。tibblet">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/01/06/tibbletime包：时序数据处理的倚天剑/"/>





  <title>tibbletime包：时序数据处理的倚天剑 | Leo Lee</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Leo Lee</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/06/tibbletime包：时序数据处理的倚天剑/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leo Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leo Lee">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">tibbletime包：时序数据处理的倚天剑</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-06T10:31:29+08:00">
                2018-01-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/R/" itemprop="url" rel="index">
                    <span itemprop="name">R</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><code>tibbletime</code>是<a href="http://www.business-science.io/" target="_blank" rel="external">Business Science</a>团队推出的一款与<code>tidyverse</code>框架完美契合的时序数据包。<code>tibbletime</code>提供了一种新的时序数据类型——<code>tbl_time</code>，其继承了R中数据框的<code>data.frame</code>类以及<code>tibble</code>包中的<code>tbl_df</code>类，与<code>dplyr</code>这一数据处理利器完美契合。同时，<code>tibbletime</code>还提供了一系列强大的函数用以处理<code>tbl_time</code>类型的数据。<br><code>tibbletime</code>包的作者这样介绍其优势：</p>
<ul>
<li><code>filter_time()</code>函数：简洁的切片操作</li>
<li><code>collapse_index()</code>函数：根据时间（例如年、月、每两周等）对索引列进行分割，进而利用<code>dplyr</code>包的分组函数计算汇总数据</li>
<li><code>as_period()</code>函数：改变一个<code>time tibble</code>的时间间隔，让日数据变为周数据/月数据更为简单</li>
<li><code>rolliyf()</code>函数：滚动分析</li>
<li><code>create_series()</code>函数：快捷地创建<code>tbl_time</code>类型的时序数据</li>
<li>索引列完美支持<code>Date</code>和<code>POSIXct</code>类型，初步支持<code>yearmon</code>，<code>yearqtr</code>和<code>hms</code>类型。</li>
</ul>
<a id="more"></a> 
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">filter_time</div><div class="line"><span class="comment">#&gt; function (.tbl_time, time_formula) </span></div><div class="line"><span class="comment">#&gt; &#123;</span></div><div class="line"><span class="comment">#&gt;     UseMethod("filter_time")</span></div><div class="line"><span class="comment">#&gt; &#125;</span></div><div class="line"><span class="comment">#&gt; &lt;environment: namespace:tibbletime&gt;</span></div><div class="line"></div><div class="line">collapse_index</div><div class="line"><span class="comment">#&gt; function (index, period = "yearly", start_date = NULL, side = "end", </span></div><div class="line"><span class="comment">#&gt;     ...) </span></div><div class="line"><span class="comment">#&gt; &#123;</span></div><div class="line"><span class="comment">#&gt;     index_part &lt;- partition_index(index, period, start_date)</span></div><div class="line"><span class="comment">#&gt;     index_num &lt;- to_posixct_numeric(index)</span></div><div class="line"><span class="comment">#&gt;     if (side == "start") &#123;</span></div><div class="line"><span class="comment">#&gt;         pos &lt;- match(unique(index_part), index_part)</span></div><div class="line"><span class="comment">#&gt;         index_at_pos &lt;- index_num[pos]</span></div><div class="line"><span class="comment">#&gt;         reps &lt;- diff(c(pos, length(index_part) + 1))</span></div><div class="line"><span class="comment">#&gt;     &#125;</span></div><div class="line"><span class="comment">#&gt;     else if (side == "end") &#123;</span></div><div class="line"><span class="comment">#&gt;         pos &lt;- length(index_part) - match(unique(index_part), </span></div><div class="line"><span class="comment">#&gt;             rev(index_part)) + 1</span></div><div class="line"><span class="comment">#&gt;         index_at_pos &lt;- index_num[pos]</span></div><div class="line"><span class="comment">#&gt;         reps &lt;- diff(c(0, pos))</span></div><div class="line"><span class="comment">#&gt;     &#125;</span></div><div class="line"><span class="comment">#&gt;     new_index &lt;- posixct_numeric_to_datetime(x = rep(index_at_pos, </span></div><div class="line"><span class="comment">#&gt;         reps), class = get_index_col_class(index), tz = get_index_col_time_zone(index))</span></div><div class="line"><span class="comment">#&gt;     new_index</span></div><div class="line"><span class="comment">#&gt; &#125;</span></div><div class="line"><span class="comment">#&gt; &lt;environment: namespace:tibbletime&gt;</span></div><div class="line"></div><div class="line">as_period</div><div class="line"><span class="comment">#&gt; function (.tbl_time, period = "yearly", start_date = NULL, side = "start", </span></div><div class="line"><span class="comment">#&gt;     include_endpoints = FALSE, ...) </span></div><div class="line"><span class="comment">#&gt; &#123;</span></div><div class="line"><span class="comment">#&gt;     UseMethod("as_period")</span></div><div class="line"><span class="comment">#&gt; &#125;</span></div><div class="line"><span class="comment">#&gt; &lt;environment: namespace:tibbletime&gt;</span></div><div class="line"></div><div class="line">rollify</div><div class="line"><span class="comment">#&gt; function (.f, window = 1, unlist = TRUE, na_value = NULL) </span></div><div class="line"><span class="comment">#&gt; &#123;</span></div><div class="line"><span class="comment">#&gt;     .f &lt;- purrr::as_mapper(.f)</span></div><div class="line"><span class="comment">#&gt;     function(...) &#123;</span></div><div class="line"><span class="comment">#&gt;         roller(..., .f = .f, window = window, unlist = unlist, </span></div><div class="line"><span class="comment">#&gt;             na_value = na_value)</span></div><div class="line"><span class="comment">#&gt;     &#125;</span></div><div class="line"><span class="comment">#&gt; &#125;</span></div><div class="line"><span class="comment">#&gt; &lt;environment: namespace:tibbletime&gt;</span></div><div class="line"></div><div class="line">create_series</div><div class="line"><span class="comment">#&gt; function (time_formula, period = "daily", class = "POSIXct", </span></div><div class="line"><span class="comment">#&gt;     include_end = FALSE, tz = "UTC", as_vector = FALSE) </span></div><div class="line"><span class="comment">#&gt; &#123;</span></div><div class="line"><span class="comment">#&gt;     period_list &lt;- parse_period(period)</span></div><div class="line"><span class="comment">#&gt;     dummy_index &lt;- make_dummy_dispatch_obj(class)</span></div><div class="line"><span class="comment">#&gt;     assert_allowed_datetime(dummy_index)</span></div><div class="line"><span class="comment">#&gt;     assert_period_matches_index_class(dummy_index, period_list$period)</span></div><div class="line"><span class="comment">#&gt;     seq_fun &lt;- lookup_seq_fun(dummy_index)</span></div><div class="line"><span class="comment">#&gt;     tf_list &lt;- parse_time_formula(dummy_index, time_formula)</span></div><div class="line"><span class="comment">#&gt;     from_to &lt;- purrr::map(tf_list, ~list_to_datetime(dummy_index, </span></div><div class="line"><span class="comment">#&gt;         .x, tz = tz))</span></div><div class="line"><span class="comment">#&gt;     from &lt;- from_to[[1]]</span></div><div class="line"><span class="comment">#&gt;     to &lt;- from_to[[2]]</span></div><div class="line"><span class="comment">#&gt;     by &lt;- paste(period_list$freq, period_list$period)</span></div><div class="line"><span class="comment">#&gt;     assert_from_before_to(from, to)</span></div><div class="line"><span class="comment">#&gt;     date_seq &lt;- seq_fun(from, to, by = by)</span></div><div class="line"><span class="comment">#&gt;     if (include_end) &#123;</span></div><div class="line"><span class="comment">#&gt;         if (max(date_seq) &lt; to) &#123;</span></div><div class="line"><span class="comment">#&gt;             date_seq &lt;- push_datetime(date_seq, to)</span></div><div class="line"><span class="comment">#&gt;         &#125;</span></div><div class="line"><span class="comment">#&gt;     &#125;</span></div><div class="line"><span class="comment">#&gt;     if (as_vector) &#123;</span></div><div class="line"><span class="comment">#&gt;         date_seq</span></div><div class="line"><span class="comment">#&gt;     &#125;</span></div><div class="line"><span class="comment">#&gt;     else &#123;</span></div><div class="line"><span class="comment">#&gt;         as_tbl_time(tibble::tibble(date = date_seq), date)</span></div><div class="line"><span class="comment">#&gt;     &#125;</span></div><div class="line"><span class="comment">#&gt; &#125;</span></div><div class="line"><span class="comment">#&gt; &lt;environment: namespace:tibbletime&gt;</span></div></pre></td></tr></table></figure>
<p>下面将通过实例来展示<code>tibbletime</code>的强大。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 安装</span></div><div class="line"><span class="comment"># 正式版</span></div><div class="line">install.packages(<span class="string">"tibbletime"</span>)</div><div class="line"><span class="comment"># 开发板</span></div><div class="line">devtools::install_github(<span class="string">"business-science/tibbletime"</span>)</div></pre></td></tr></table></figure>
<h2 id="tibbletime操作"><a href="#tibbletime操作" class="headerlink" title="tibbletime操作"></a><code>tibbletime</code>操作</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(dplyr)</div><div class="line"><span class="comment">#&gt; </span></div><div class="line"><span class="comment">#&gt; Attaching package: 'dplyr'</span></div><div class="line"><span class="comment">#&gt; The following objects are masked from 'package:stats':</span></div><div class="line"><span class="comment">#&gt; </span></div><div class="line"><span class="comment">#&gt;     filter, lag</span></div><div class="line"><span class="comment">#&gt; The following objects are masked from 'package:base':</span></div><div class="line"><span class="comment">#&gt; </span></div><div class="line"><span class="comment">#&gt;     intersect, setdiff, setequal, union</span></div><div class="line"><span class="keyword">library</span>(tibbletime)</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ls(getNamespace("tibbletime"))</span></div><div class="line">ls(<span class="string">"package:tibbletime"</span>)</div><div class="line"><span class="comment">#&gt;  [1] "%&gt;%"                 "as_period"           "as_tbl_time"        </span></div><div class="line"><span class="comment">#&gt;  [4] "ceiling_index"       "collapse_index"      "create_series"      </span></div><div class="line"><span class="comment">#&gt;  [7] "filter"              "filter_time"         "floor_index"        </span></div><div class="line"><span class="comment">#&gt; [10] "get_index_char"      "get_index_class"     "get_index_col"      </span></div><div class="line"><span class="comment">#&gt; [13] "get_index_quo"       "get_index_time_zone" "parse_period"       </span></div><div class="line"><span class="comment">#&gt; [16] "partition_index"     "reconstruct"         "rollify"            </span></div><div class="line"><span class="comment">#&gt; [19] "tbl_time"</span></div></pre></td></tr></table></figure>
<h3 id="将常规的数据框转化为tbl-time"><a href="#将常规的数据框转化为tbl-time" class="headerlink" title="将常规的数据框转化为tbl_time"></a>将常规的数据框转化为<code>tbl_time</code></h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Facebook stock prices. Comes with the package</span></div><div class="line">data(<span class="string">"FB"</span>)</div><div class="line">FB</div><div class="line"><span class="comment">#&gt; # A tibble: 1,008 x 8</span></div><div class="line"><span class="comment">#&gt;    symbol date        open  high   low close    volume adjusted</span></div><div class="line"><span class="comment">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</span></div><div class="line"><span class="comment">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</span></div><div class="line"><span class="comment">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</span></div><div class="line"><span class="comment">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</span></div><div class="line"><span class="comment">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</span></div><div class="line"><span class="comment">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</span></div><div class="line"><span class="comment">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</span></div><div class="line"><span class="comment">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</span></div><div class="line"><span class="comment">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</span></div><div class="line"><span class="comment">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</span></div><div class="line"><span class="comment">#&gt; # ... with 998 more rows</span></div><div class="line">class(FB)</div><div class="line"><span class="comment">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">FB_tbl_time &lt;- FB %&gt;% </div><div class="line">  as_tbl_time(index = date)</div><div class="line">FB_tbl_time</div><div class="line"><span class="comment">#&gt; # A time tibble: 1,008 x 8</span></div><div class="line"><span class="comment">#&gt; # Index: date</span></div><div class="line"><span class="comment">#&gt;    symbol date        open  high   low close    volume adjusted</span></div><div class="line"><span class="comment">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</span></div><div class="line"><span class="comment">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</span></div><div class="line"><span class="comment">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</span></div><div class="line"><span class="comment">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</span></div><div class="line"><span class="comment">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</span></div><div class="line"><span class="comment">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</span></div><div class="line"><span class="comment">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</span></div><div class="line"><span class="comment">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</span></div><div class="line"><span class="comment">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</span></div><div class="line"><span class="comment">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</span></div><div class="line"><span class="comment">#&gt; # ... with 998 more rows</span></div><div class="line">class(FB_tbl_time)</div><div class="line"><span class="comment">#&gt; [1] "tbl_time"   "tbl_df"     "tbl"        "data.frame"</span></div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">my_df &lt;- data.frame(x1 = Sys.time() + <span class="number">1</span>:<span class="number">20</span>,</div><div class="line">                    x2 = letters[<span class="number">1</span>:<span class="number">20</span>],</div><div class="line">                    x3 = round(rnorm(<span class="number">20</span>, mean = <span class="number">3</span>), <span class="number">4</span>))</div><div class="line">head(my_df)</div><div class="line"><span class="comment">#&gt;                    x1 x2     x3</span></div><div class="line"><span class="comment">#&gt; 1 2018-01-06 10:28:58  a 3.4440</span></div><div class="line"><span class="comment">#&gt; 2 2018-01-06 10:28:59  b 4.3121</span></div><div class="line"><span class="comment">#&gt; 3 2018-01-06 10:29:00  c 2.5993</span></div><div class="line"><span class="comment">#&gt; 4 2018-01-06 10:29:01  d 3.0153</span></div><div class="line"><span class="comment">#&gt; 5 2018-01-06 10:29:02  e 3.1968</span></div><div class="line"><span class="comment">#&gt; 6 2018-01-06 10:29:03  f 1.5981</span></div><div class="line"></div><div class="line">my_df %&gt;% </div><div class="line">  as_tbl_time(index = x1) %&gt;% </div><div class="line">  head(n = <span class="number">4</span>)</div><div class="line"><span class="comment">#&gt; # A time tibble: 4 x 3</span></div><div class="line"><span class="comment">#&gt; # Index: x1</span></div><div class="line"><span class="comment">#&gt;   x1                  x2        x3</span></div><div class="line"><span class="comment">#&gt;   &lt;dttm&gt;              &lt;fctr&gt; &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt; 1 2018-01-06 10:28:58 a       3.44</span></div><div class="line"><span class="comment">#&gt; 2 2018-01-06 10:28:59 b       4.31</span></div><div class="line"><span class="comment">#&gt; 3 2018-01-06 10:29:00 c       2.60</span></div><div class="line"><span class="comment">#&gt; 4 2018-01-06 10:29:01 d       3.02</span></div></pre></td></tr></table></figure>
<h3 id="对tbl-time对象切片"><a href="#对tbl-time对象切片" class="headerlink" title="对tbl_time对象切片"></a>对<code>tbl_time</code>对象切片</h3><blockquote>
<p><code>filter_time()</code>函数</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">filter_time</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#&gt; function (.tbl_time, time_formula) </div><div class="line">#&gt; &#123;</div><div class="line">#&gt;     UseMethod(&quot;filter_time&quot;)</div><div class="line">#&gt; &#125;</div><div class="line">#&gt; &lt;environment: namespace:tibbletime&gt;</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 提取2013年3月至2015年的数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  filter_time(time_formula = <span class="string">'2013-03'</span> ~ <span class="string">'2015'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 716 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close   volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-03-01  27.0  28.1  26.8  27.8 54064800     27.8</div><div class="line">#&gt;  2 FB     2013-03-04  27.8  28.1  27.4  27.7 32400700     27.7</div><div class="line">#&gt;  3 FB     2013-03-05  27.9  28.2  27.2  27.5 40622200     27.5</div><div class="line">#&gt;  4 FB     2013-03-06  28.1  28.1  27.4  27.5 33532600     27.5</div><div class="line">#&gt;  5 FB     2013-03-07  27.6  28.7  27.5  28.6 74540200     28.6</div><div class="line">#&gt;  6 FB     2013-03-08  28.4  28.5  27.7  28.0 44198900     28.0</div><div class="line">#&gt;  7 FB     2013-03-11  28.0  28.6  27.8  28.1 35642100     28.1</div><div class="line">#&gt;  8 FB     2013-03-12  28.1  28.3  27.6  27.8 27569600     27.8</div><div class="line">#&gt;  9 FB     2013-03-13  27.6  27.6  26.9  27.1 39619500     27.1</div><div class="line">#&gt; 10 FB     2013-03-14  27.1  27.4  26.8  27.0 27646400     27.0</div><div class="line">#&gt; # ... with 706 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 提取2013年1月2日至2013年12月31日的数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  filter_time(time_formula = <span class="string">"2013-01-02"</span> ~ <span class="string">"2013-12-31"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 252 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt; # ... with 242 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 注：这里`~`两边的时间/日期都包含在内</span></div></pre></td></tr></table></figure>
<p>利用<code>dplyr</code>独立完成这一操作的代码如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">FB_tbl_time %&gt;% </div><div class="line">  filter(date &gt;= as.Date(<span class="string">"2013-01-02"</span>), date &lt;= as.Date(<span class="string">"2013-12-31"</span>))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 252 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt; # ... with 242 more rows</div></pre></td></tr></table></figure>
<p>可以看到，代码量增加了很多。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 提取2013年1月至2014年2月的数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  filter_time(<span class="string">"2013-01"</span> ~ <span class="string">"2014-02"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 292 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt; # ... with 282 more rows</div></pre></td></tr></table></figure>
<p>当然，利用<code>tibbletime</code>代码还可以进一步的缩减。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 提取2013年一整年的数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  filter_time(time_formula = <span class="string">"2013"</span> ~ <span class="string">"2013"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 252 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt; # ... with 242 more rows</div></pre></td></tr></table></figure>
<p>还长了，再缩减一下</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 提取2013年一整年的数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  filter_time(time_formula = ~ <span class="string">"2013"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 252 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt; # ... with 242 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 提取2015年3月份的数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  filter_time(time_formula = ~ <span class="string">"2015-03"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 22 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close   volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2015-03-02  79.0  79.9  78.5  79.8 21662500     79.8</div><div class="line">#&gt;  2 FB     2015-03-03  79.6  79.7  78.5  79.6 18635000     79.6</div><div class="line">#&gt;  3 FB     2015-03-04  79.3  81.2  78.8  80.9 28126700     80.9</div><div class="line">#&gt;  4 FB     2015-03-05  81.2  82.0  81.1  81.2 27825700     81.2</div><div class="line">#&gt;  5 FB     2015-03-06  80.9  81.3  79.8  80.0 24488600     80.0</div><div class="line">#&gt;  6 FB     2015-03-09  79.7  79.9  78.6  79.4 18925100     79.4</div><div class="line">#&gt;  7 FB     2015-03-10  78.5  79.3  77.6  77.6 23067100     77.6</div><div class="line">#&gt;  8 FB     2015-03-11  77.8  78.4  77.3  77.6 20215700     77.6</div><div class="line">#&gt;  9 FB     2015-03-12  78.1  79.1  77.9  78.9 16093300     78.9</div><div class="line">#&gt; 10 FB     2015-03-13  78.6  79.4  77.7  78.1 18557300     78.1</div><div class="line">#&gt; # ... with 12 more rows</div></pre></td></tr></table></figure>
<p><strong>两个关键词参数</strong></p>
<ul>
<li><code>start</code></li>
<li><code>end</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 提取从序列开始到2015年的所有数据，包含2015年</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  filter_time(time_formula = <span class="string">"start"</span> ~ <span class="string">"2015"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 756 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt; # ... with 746 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 提取从2015年到序列结束的所有数据，包含2015年</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  filter_time(time_formula = <span class="string">"2015"</span> ~ <span class="string">"end"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 504 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close   volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2015-01-02  78.6  78.9  77.7  78.4 18177500     78.4</div><div class="line">#&gt;  2 FB     2015-01-05  78.0  79.2  76.9  77.2 26452200     77.2</div><div class="line">#&gt;  3 FB     2015-01-06  77.2  77.6  75.4  76.2 27399300     76.2</div><div class="line">#&gt;  4 FB     2015-01-07  76.8  77.4  75.8  76.2 22045300     76.2</div><div class="line">#&gt;  5 FB     2015-01-08  76.7  78.2  76.1  78.2 23961000     78.2</div><div class="line">#&gt;  6 FB     2015-01-09  78.2  78.6  77.2  77.7 21157000     77.7</div><div class="line">#&gt;  7 FB     2015-01-12  77.8  78.0  76.2  76.7 19190200     76.7</div><div class="line">#&gt;  8 FB     2015-01-13  77.2  78.1  75.8  76.4 25179600     76.4</div><div class="line">#&gt;  9 FB     2015-01-14  76.4  77.2  76.0  76.3 25741000     76.3</div><div class="line">#&gt; 10 FB     2015-01-15  76.4  76.6  73.5  74.1 34134000     74.1</div><div class="line">#&gt; # ... with 494 more rows</div></pre></td></tr></table></figure>
<h4 id="对分组后的tbl-time对象进行取子集操作"><a href="#对分组后的tbl-time对象进行取子集操作" class="headerlink" title="对分组后的tbl_time对象进行取子集操作"></a>对分组后的<code>tbl_time</code>对象进行取子集操作</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Facebook, Amazon, Netify, Google</span></div><div class="line">data(<span class="string">"FANG"</span>)</div><div class="line">FANG</div><div class="line"><span class="comment">#&gt; # A tibble: 4,032 x 8</span></div><div class="line"><span class="comment">#&gt;    symbol date        open  high   low close    volume adjusted</span></div><div class="line"><span class="comment">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</span></div><div class="line"><span class="comment">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</span></div><div class="line"><span class="comment">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</span></div><div class="line"><span class="comment">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</span></div><div class="line"><span class="comment">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</span></div><div class="line"><span class="comment">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</span></div><div class="line"><span class="comment">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</span></div><div class="line"><span class="comment">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</span></div><div class="line"><span class="comment">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</span></div><div class="line"><span class="comment">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</span></div><div class="line"><span class="comment">#&gt; # ... with 4,022 more rows</span></div><div class="line"></div><div class="line">FANG %&gt;% </div><div class="line">  as_tbl_time(index = date) %&gt;% </div><div class="line">  group_by(symbol) %&gt;% </div><div class="line">  filter_time(time_formula = <span class="string">'2013-01-01'</span> ~ <span class="string">'2013-01-04'</span>)</div><div class="line"><span class="comment">#&gt; # A time tibble: 12 x 8</span></div><div class="line"><span class="comment">#&gt; # Index:  date</span></div><div class="line"><span class="comment">#&gt; # Groups: symbol [4]</span></div><div class="line"><span class="comment">#&gt;    symbol date        open  high   low close   volume adjusted</span></div><div class="line"><span class="comment">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0 69846400     28.0</span></div><div class="line"><span class="comment">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8 63140600     27.8</span></div><div class="line"><span class="comment">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8 72715400     28.8</span></div><div class="line"><span class="comment">#&gt;  4 AMZN   2013-01-02 256   258   253   257    3271000    257  </span></div><div class="line"><span class="comment">#&gt;  5 AMZN   2013-01-03 257   261   256   258    2750900    258  </span></div><div class="line"><span class="comment">#&gt;  6 AMZN   2013-01-04 258   260   257   259    1874200    259  </span></div><div class="line"><span class="comment">#&gt;  7 NFLX   2013-01-02  95.2  95.8  90.7  92.0 19431300     13.1</span></div><div class="line"><span class="comment">#&gt;  8 NFLX   2013-01-03  92.0  97.9  91.5  96.6 27912500     13.8</span></div><div class="line"><span class="comment">#&gt;  9 NFLX   2013-01-04  96.5  97.7  95.5  96.0 17761100     13.7</span></div><div class="line"><span class="comment">#&gt; 10 GOOG   2013-01-02 719   727   717   723    5101500    361  </span></div><div class="line"><span class="comment">#&gt; 11 GOOG   2013-01-03 725   732   721   724    4653700    361  </span></div><div class="line"><span class="comment">#&gt; 12 GOOG   2013-01-04 729   741   728   738    5547600    369</span></div></pre></td></tr></table></figure>
<h4 id="根据分钟-秒来提取子集"><a href="#根据分钟-秒来提取子集" class="headerlink" title="根据分钟/秒来提取子集"></a>根据分钟/秒来提取子集</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">my_df &lt;- tibble::tibble(</div><div class="line">  date = lubridate::as_datetime(c(<span class="string">"2018-01-05 20:54:16"</span>,</div><div class="line">                                  <span class="string">"2018-01-05 20:54:18"</span>,</div><div class="line">                                  <span class="string">"2018-01-05 20:55:54"</span>,</div><div class="line">                                  <span class="string">"2018-01-05 20:54:24"</span>,</div><div class="line">                                  <span class="string">"2018-01-05 20:55:44"</span>,</div><div class="line">                                  <span class="string">"2018-01-05 20:54:34"</span>)),  </div><div class="line">  x2 = rnorm(<span class="number">6</span>)</div><div class="line">)</div><div class="line">my_df</div><div class="line"><span class="comment">#&gt; # A tibble: 6 x 2</span></div><div class="line"><span class="comment">#&gt;   date                    x2</span></div><div class="line"><span class="comment">#&gt;   &lt;dttm&gt;               &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt; 1 2018-01-05 20:54:16 -0.343</span></div><div class="line"><span class="comment">#&gt; 2 2018-01-05 20:54:18 -0.194</span></div><div class="line"><span class="comment">#&gt; 3 2018-01-05 20:55:54  0.402</span></div><div class="line"><span class="comment">#&gt; 4 2018-01-05 20:54:24 -0.753</span></div><div class="line"><span class="comment">#&gt; 5 2018-01-05 20:55:44 -0.294</span></div><div class="line"><span class="comment">#&gt; 6 2018-01-05 20:54:34 -1.97</span></div><div class="line"></div><div class="line">my_df %&gt;% </div><div class="line">  arrange(date) %&gt;% </div><div class="line">  as_tbl_time(index = date) %&gt;% </div><div class="line">  filter_time(time_formula = <span class="string">"2018-01-05 + 20:54:16"</span> ~ <span class="string">"2018-01-05 + 20:54:44"</span>)</div><div class="line"><span class="comment">#&gt; # A time tibble: 4 x 2</span></div><div class="line"><span class="comment">#&gt; # Index: date</span></div><div class="line"><span class="comment">#&gt;   date                    x2</span></div><div class="line"><span class="comment">#&gt;   &lt;dttm&gt;               &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt; 1 2018-01-05 20:54:16 -0.343</span></div><div class="line"><span class="comment">#&gt; 2 2018-01-05 20:54:18 -0.194</span></div><div class="line"><span class="comment">#&gt; 3 2018-01-05 20:54:24 -0.753</span></div><div class="line"><span class="comment">#&gt; 4 2018-01-05 20:54:34 -1.97</span></div></pre></td></tr></table></figure>
<p>除了使用<code>filter_time()</code>函数进行取子集操作外，<code>tibbletime</code>还支持常规的<code>[</code>操作。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">FB_tbl_time[~ <span class="string">"2013"</span>]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 252 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt; # ... with 242 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">FB_tbl_time[<span class="string">"2013"</span> ~ <span class="string">"2014-02"</span>, c(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 292 x 3</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4</div><div class="line">#&gt;  2 FB     2013-01-03  27.9</div><div class="line">#&gt;  3 FB     2013-01-04  28.0</div><div class="line">#&gt;  4 FB     2013-01-07  28.7</div><div class="line">#&gt;  5 FB     2013-01-08  29.5</div><div class="line">#&gt;  6 FB     2013-01-09  29.7</div><div class="line">#&gt;  7 FB     2013-01-10  30.6</div><div class="line">#&gt;  8 FB     2013-01-11  31.3</div><div class="line">#&gt;  9 FB     2013-01-14  32.1</div><div class="line">#&gt; 10 FB     2013-01-15  30.6</div><div class="line">#&gt; # ... with 282 more rows</div></pre></td></tr></table></figure>
<h4 id="利用filter-time-函数进行编程"><a href="#利用filter-time-函数进行编程" class="headerlink" title="利用filter_time()函数进行编程"></a>利用<code>filter_time()</code>函数进行编程</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">date_var &lt;- as.Date(<span class="string">"2014-01-01"</span>)</div><div class="line">filter_time(FB_tbl_time, <span class="string">'start'</span> ~ date_var)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 252 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt; # ... with 242 more rows</div></pre></td></tr></table></figure>
<h3 id="对tbl-time对象进行高频转低频"><a href="#对tbl-time对象进行高频转低频" class="headerlink" title="对tbl_time对象进行高频转低频"></a>对<code>tbl_time</code>对象进行高频转低频</h3><blockquote>
<p><code>as_period()</code>函数</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">as_period</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#&gt; function (.tbl_time, period = &quot;yearly&quot;, start_date = NULL, side = &quot;start&quot;, </div><div class="line">#&gt;     include_endpoints = FALSE, ...) </div><div class="line">#&gt; &#123;</div><div class="line">#&gt;     UseMethod(&quot;as_period&quot;)</div><div class="line">#&gt; &#125;</div><div class="line">#&gt; &lt;environment: namespace:tibbletime&gt;</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 将日数据转化为周数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  as_period(period = <span class="string">"weekly"</span>, side = <span class="string">"start"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 209 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close   volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0 69846400     28.0</div><div class="line">#&gt;  2 FB     2013-01-07  28.7  29.8  28.6  29.4 83781800     29.4</div><div class="line">#&gt;  3 FB     2013-01-14  32.1  32.2  30.6  31.0 98892800     31.0</div><div class="line">#&gt;  4 FB     2013-01-22  29.8  30.9  29.7  30.7 55243300     30.7</div><div class="line">#&gt;  5 FB     2013-01-28  31.9  32.5  31.8  32.5 59682500     32.5</div><div class="line">#&gt;  6 FB     2013-02-04  29.1  29.2  28.0  28.1 92362200     28.1</div><div class="line">#&gt;  7 FB     2013-02-11  28.6  28.7  28.0  28.3 37361800     28.3</div><div class="line">#&gt;  8 FB     2013-02-19  28.2  29.1  28.1  28.9 49396400     28.9</div><div class="line">#&gt;  9 FB     2013-02-25  27.2  27.6  27.2  27.3 34652000     27.3</div><div class="line">#&gt; 10 FB     2013-03-04  27.8  28.1  27.4  27.7 32400700     27.7</div><div class="line">#&gt; # ... with 199 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># side = "start"表示取每一个时间区间的第一个值</span></div><div class="line"><span class="comment"># 这里是取每周的第一个值</span></div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 将日数据转化为月数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  as_period(<span class="string">"monthly"</span>, side = <span class="string">"end"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 48 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-31  29.2  31.5  28.7  31.0 190744900     31.0</div><div class="line">#&gt;  2 FB     2013-02-28  26.8  27.3  26.3  27.2  83027800     27.2</div><div class="line">#&gt;  3 FB     2013-03-28  26.1  26.2  25.5  25.6  28585700     25.6</div><div class="line">#&gt;  4 FB     2013-04-30  27.1  27.8  27.0  27.8  36245700     27.8</div><div class="line">#&gt;  5 FB     2013-05-31  24.6  25.0  24.3  24.4  35925000     24.4</div><div class="line">#&gt;  6 FB     2013-06-28  24.7  25.0  24.4  24.9  96778900     24.9</div><div class="line">#&gt;  7 FB     2013-07-31  38.0  38.3  36.3  36.8 154828700     36.8</div><div class="line">#&gt;  8 FB     2013-08-30  42.0  42.3  41.1  41.3  67735100     41.3</div><div class="line">#&gt;  9 FB     2013-09-30  50.1  51.6  49.8  50.2 100095000     50.2</div><div class="line">#&gt; 10 FB     2013-10-31  47.2  52.0  46.5  50.2 248809000     50.2</div><div class="line">#&gt; # ... with 38 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># side = "end"表示取每一个时间区间的最后一个值</span></div><div class="line"><span class="comment"># 这里是取每月的最后一个值</span></div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 将日数据转化为季数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  as_period(period = <span class="string">"quarterly"</span>, side = <span class="string">"start"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 16 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close   volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0 69846400     28.0</div><div class="line">#&gt;  2 FB     2013-04-01  25.6  25.9  25.3  25.5 22249300     25.5</div><div class="line">#&gt;  3 FB     2013-07-01  25.0  25.1  24.6  24.8 20582200     24.8</div><div class="line">#&gt;  4 FB     2013-10-01  50.0  51.0  49.5  50.4 98114000     50.4</div><div class="line">#&gt;  5 FB     2014-01-02  54.8  55.2  54.2  54.7 43195500     54.7</div><div class="line">#&gt;  6 FB     2014-04-01  60.5  62.7  60.2  62.6 59291000     62.6</div><div class="line">#&gt;  7 FB     2014-07-01  67.6  68.4  67.4  68.1 33243000     68.1</div><div class="line">#&gt;  8 FB     2014-10-01  78.8  78.8  75.9  76.6 55090000     76.6</div><div class="line">#&gt;  9 FB     2015-01-02  78.6  78.9  77.7  78.4 18177500     78.4</div><div class="line">#&gt; 10 FB     2015-04-01  82.5  82.7  80.9  81.7 22058200     81.7</div><div class="line">#&gt; 11 FB     2015-07-01  86.8  87.9  86.5  86.9 25260000     86.9</div><div class="line">#&gt; 12 FB     2015-10-01  90.1  90.9  88.4  90.9 29283700     90.9</div><div class="line">#&gt; 13 FB     2016-01-04 102   102    99.8 102   37912400    102  </div><div class="line">#&gt; 14 FB     2016-04-01 114   116   113   116   24760500    116  </div><div class="line">#&gt; 15 FB     2016-07-01 114   115   114   114   14980000    114  </div><div class="line">#&gt; 16 FB     2016-10-03 128   129   128   129   13156900    129</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># side = "start"表示取每一个时间区间的第一个值</span></div><div class="line"><span class="comment"># 这里是取每季度的第一个值</span></div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 将日数据转化为年数据</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  as_period(period = <span class="string">"yearly"</span>, side = <span class="string">"start"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 4 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;   symbol date        open  high   low close   volume adjusted</div><div class="line">#&gt;   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt; 1 FB     2013-01-02  27.4  28.2  27.4  28.0 69846400     28.0</div><div class="line">#&gt; 2 FB     2014-01-02  54.8  55.2  54.2  54.7 43195500     54.7</div><div class="line">#&gt; 3 FB     2015-01-02  78.6  78.9  77.7  78.4 18177500     78.4</div><div class="line">#&gt; 4 FB     2016-01-04 102   102    99.8 102   37912400    102</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># side = "start"表示取每一个时间区间的第一个值</span></div><div class="line"><span class="comment"># 这里是取每年的第一个值</span></div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 将日数据转化为每4天一次</span></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  as_period(period = <span class="string">"5 days"</span>, start_date = as.Date(<span class="string">"2013-01-01"</span>), side = <span class="string">"end"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 292 x 8</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  2 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  3 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt;  4 FB     2013-01-18  30.3  30.4  29.3  29.7  49631500     29.7</div><div class="line">#&gt;  5 FB     2013-01-25  31.4  31.9  31.1  31.5  54363600     31.5</div><div class="line">#&gt;  6 FB     2013-01-30  31.0  31.5  30.9  31.2  87682100     31.2</div><div class="line">#&gt;  7 FB     2013-02-04  29.1  29.2  28.0  28.1  92362200     28.1</div><div class="line">#&gt;  8 FB     2013-02-08  28.9  29.2  28.5  28.5  37708800     28.5</div><div class="line">#&gt;  9 FB     2013-02-14  28.0  28.6  28.0  28.5  35615800     28.5</div><div class="line">#&gt; 10 FB     2013-02-19  28.2  29.1  28.1  28.9  49396400     28.9</div><div class="line">#&gt; # ... with 282 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 注：这里的`start_date`必须小于或者等于时间索引列的最小值</span></div><div class="line"><span class="comment"># 这里原始索引列的最小值为`2013-01-02`，这里`start_date`设置为`2013-01-01`，做了更改。</span></div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 操作分组数据</span></div><div class="line">data(<span class="string">"FANG"</span>)</div><div class="line">FANG %&gt;% </div><div class="line">  group_by(symbol) %&gt;% </div><div class="line">  as_tbl_time(index = date) %&gt;% </div><div class="line">  as_period(period = <span class="string">"2 years"</span>, side = <span class="string">"start"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 8 x 8</div><div class="line">#&gt; # Index:  date</div><div class="line">#&gt; # Groups: symbol [4]</div><div class="line">#&gt;   symbol date        open  high   low close   volume adjusted</div><div class="line">#&gt;   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt; 1 FB     2013-01-02  27.4  28.2  27.4  28.0 69846400     28.0</div><div class="line">#&gt; 2 FB     2015-01-02  78.6  78.9  77.7  78.4 18177500     78.4</div><div class="line">#&gt; 3 AMZN   2013-01-02 256   258   253   257    3271000    257  </div><div class="line">#&gt; 4 AMZN   2015-01-02 313   315   307   309    2783200    309  </div><div class="line">#&gt; 5 NFLX   2013-01-02  95.2  95.8  90.7  92.0 19431300     13.1</div><div class="line">#&gt; 6 NFLX   2015-01-02 344   352   341   349   13475000     49.8</div><div class="line">#&gt; 7 GOOG   2013-01-02 719   727   717   723    5101500    361  </div><div class="line">#&gt; 8 GOOG   2015-01-02 529   531   524   525    1447500    525</div></pre></td></tr></table></figure>
<h3 id="滚动计算"><a href="#滚动计算" class="headerlink" title="滚动计算"></a>滚动计算</h3><blockquote>
<p><code>rollify()</code>函数</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rollify</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#&gt; function (.f, window = 1, unlist = TRUE, na_value = NULL) </div><div class="line">#&gt; &#123;</div><div class="line">#&gt;     .f &lt;- purrr::as_mapper(.f)</div><div class="line">#&gt;     function(...) &#123;</div><div class="line">#&gt;         roller(..., .f = .f, window = window, unlist = unlist, </div><div class="line">#&gt;             na_value = na_value)</div><div class="line">#&gt;     &#125;</div><div class="line">#&gt; &#125;</div><div class="line">#&gt; &lt;environment: namespace:tibbletime&gt;</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 计算5期的移动平均</span></div><div class="line">mean_5 &lt;- rollify(mean, window = <span class="number">5</span>) <span class="comment"># `window`表示滚动窗口</span></div><div class="line">mean_5</div><div class="line"><span class="comment">#&gt; function (...) </span></div><div class="line"><span class="comment">#&gt; &#123;</span></div><div class="line"><span class="comment">#&gt;     roller(..., .f = .f, window = window, unlist = unlist, na_value = na_value)</span></div><div class="line"><span class="comment">#&gt; &#125;</span></div><div class="line"><span class="comment">#&gt; &lt;environment: 0x000000001903d058&gt;</span></div><div class="line"></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  mutate(roll_mean = mean_5(adjusted))</div><div class="line"><span class="comment">#&gt; # A time tibble: 1,008 x 9</span></div><div class="line"><span class="comment">#&gt; # Index: date</span></div><div class="line"><span class="comment">#&gt;    symbol date        open  high   low close    volume adjusted roll_mean</span></div><div class="line"><span class="comment">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0      NA  </span></div><div class="line"><span class="comment">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8      NA  </span></div><div class="line"><span class="comment">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8      NA  </span></div><div class="line"><span class="comment">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4      NA  </span></div><div class="line"><span class="comment">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1      28.6</span></div><div class="line"><span class="comment">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6      29.1</span></div><div class="line"><span class="comment">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3      29.8</span></div><div class="line"><span class="comment">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7      30.4</span></div><div class="line"><span class="comment">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0      30.7</span></div><div class="line"><span class="comment">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1      30.9</span></div><div class="line"><span class="comment">#&gt; # ... with 998 more rows</span></div><div class="line"></div><div class="line">FB_tbl_time %&gt;% </div><div class="line">  pull(adjusted) %&gt;% </div><div class="line">  .[<span class="number">1</span>:<span class="number">5</span>] %&gt;% </div><div class="line">  mean(., na.rm = <span class="literal">TRUE</span>) <span class="comment"># 正是`roll_mean`这一列的计算方法</span></div><div class="line"><span class="comment">#&gt; [1] 28.602</span></div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 计算2，3，4期的移动平均</span></div><div class="line">rolling_mean_2 &lt;- rollify(mean, window = <span class="number">2</span>)</div><div class="line">rolling_mean_3 &lt;- rollify(mean, window = <span class="number">3</span>)</div><div class="line">rolling_mean_4 &lt;- rollify(mean, window = <span class="number">4</span>)</div><div class="line"></div><div class="line">FB %&gt;% mutate(</div><div class="line">  rm10 = rolling_mean_2(adjusted),</div><div class="line">  rm20 = rolling_mean_3(adjusted),</div><div class="line">  rm30 = rolling_mean_4(adjusted)</div><div class="line">)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#&gt; # A tibble: 1,008 x 11</div><div class="line">#&gt;    symb~ date        open  high   low close volume adju~  rm10  rm20  rm30</div><div class="line">#&gt;    &lt;chr&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</div><div class="line">#&gt;  1 FB    2013-01-02  27.4  28.2  27.4  28.0 6.98e7  28.0  NA    NA    NA  </div><div class="line">#&gt;  2 FB    2013-01-03  27.9  28.5  27.6  27.8 6.31e7  27.8  27.9  NA    NA  </div><div class="line">#&gt;  3 FB    2013-01-04  28.0  28.9  27.8  28.8 7.27e7  28.8  28.3  28.2  NA  </div><div class="line">#&gt;  4 FB    2013-01-07  28.7  29.8  28.6  29.4 8.38e7  29.4  29.1  28.6  28.5</div><div class="line">#&gt;  5 FB    2013-01-08  29.5  29.6  28.9  29.1 4.59e7  29.1  29.2  29.1  28.8</div><div class="line">#&gt;  6 FB    2013-01-09  29.7  30.6  29.5  30.6 1.05e8  30.6  29.8  29.7  29.5</div><div class="line">#&gt;  7 FB    2013-01-10  30.6  31.5  30.3  31.3 9.53e7  31.3  30.9  30.3  30.1</div><div class="line">#&gt;  8 FB    2013-01-11  31.3  32.0  31.1  31.7 8.96e7  31.7  31.5  31.2  30.7</div><div class="line">#&gt;  9 FB    2013-01-14  32.1  32.2  30.6  31.0 9.89e7  31.0  31.3  31.3  31.1</div><div class="line">#&gt; 10 FB    2013-01-15  30.6  31.7  29.9  30.1 1.73e8  30.1  30.5  30.9  31.0</div><div class="line">#&gt; # ... with 998 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 开盘价和收盘价均价的5期移动平均值</span></div><div class="line">rolling_avg_sum &lt;- rollify(~ mean(.x + .y), window = <span class="number">5</span>)</div><div class="line"></div><div class="line">mutate(FB_tbl_time, avg_sum = rolling_avg_sum(open, close))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 1,008 x 9</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted avg_sum</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0    NA  </div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8    NA  </div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8    NA  </div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4    NA  </div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1    56.9</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6    57.9</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3    59.1</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7    60.4</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0    61.4</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1    61.8</div><div class="line">#&gt; # ... with 998 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 实现list-column</span></div><div class="line">summary_df &lt;- <span class="keyword">function</span>(x) &#123;</div><div class="line">  data.frame(  </div><div class="line">    rolled_summary_type = c(<span class="string">"mean"</span>, <span class="string">"sd"</span>,  <span class="string">"min"</span>,  <span class="string">"max"</span>,  <span class="string">"median"</span>),</div><div class="line">    rolled_summary_val  = c(mean(x), sd(x), min(x), max(x), median(x))</div><div class="line">  )</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># A rolling version, with unlist = FALSE</span></div><div class="line">rolling_summary &lt;- rollify(~ summary_df(.x), window = <span class="number">5</span>, </div><div class="line">                           unlist = <span class="literal">FALSE</span>)</div><div class="line"></div><div class="line">FB_summarised &lt;- mutate(FB_tbl_time, summary_list_col = rolling_summary(adjusted))</div><div class="line">FB_summarised</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 1,008 x 9</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted summary_l~</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;list&gt;    </div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0 &lt;lgl [1]&gt; </div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8 &lt;lgl [1]&gt; </div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8 &lt;lgl [1]&gt; </div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4 &lt;lgl [1]&gt; </div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1 &lt;data.fra~</div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6 &lt;data.fra~</div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3 &lt;data.fra~</div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7 &lt;data.fra~</div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0 &lt;data.fra~</div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1 &lt;data.fra~</div><div class="line">#&gt; # ... with 998 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">FB_summarised %&gt;% </div><div class="line">  filter(!is.na(summary_list_col)) %&gt;%</div><div class="line">  tidyr::unnest()</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 5,020 x 10</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjus~ roll~ rolle~</div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;  &lt;dbl&gt;</div><div class="line">#&gt;  1 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 mean  28.6  </div><div class="line">#&gt;  2 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 sd     0.700</div><div class="line">#&gt;  3 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 min   27.8  </div><div class="line">#&gt;  4 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 max   29.4  </div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 medi~ 28.8  </div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 mean  29.1  </div><div class="line">#&gt;  7 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 sd     1.03 </div><div class="line">#&gt;  8 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 min   27.8  </div><div class="line">#&gt;  9 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 max   30.6  </div><div class="line">#&gt; 10 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 medi~ 29.1  </div><div class="line">#&gt; # ... with 5,010 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 计算移动平均后缺失值的处理问题</span></div><div class="line">rolling_summary &lt;- rollify(~summary_df(.x), window = <span class="number">5</span>, </div><div class="line">                           unlist = <span class="literal">FALSE</span>, na_value = data.frame())</div><div class="line"></div><div class="line">FB_summarised &lt;- mutate(FB, summary_list_col = rolling_summary(adjusted))</div><div class="line">FB_summarised</div><div class="line"><span class="comment">#&gt; # A tibble: 1,008 x 9</span></div><div class="line"><span class="comment">#&gt;    symbol date        open  high   low close    volume adjusted summary_l~</span></div><div class="line"><span class="comment">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;list&gt;    </span></div><div class="line"><span class="comment">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1 &lt;data.fra~</span></div><div class="line"><span class="comment">#&gt; # ... with 998 more rows</span></div><div class="line"></div><div class="line">FB_summarised %&gt;% </div><div class="line">  tidyr::unnest()</div><div class="line"><span class="comment">#&gt; # A tibble: 5,020 x 10</span></div><div class="line"><span class="comment">#&gt;    symbol date        open  high   low close    volume adjus~ roll~ rolle~</span></div><div class="line"><span class="comment">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;  &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 mean  28.6  </span></div><div class="line"><span class="comment">#&gt;  2 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 sd     0.700</span></div><div class="line"><span class="comment">#&gt;  3 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 min   27.8  </span></div><div class="line"><span class="comment">#&gt;  4 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 max   29.4  </span></div><div class="line"><span class="comment">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300   29.1 medi~ 28.8  </span></div><div class="line"><span class="comment">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 mean  29.1  </span></div><div class="line"><span class="comment">#&gt;  7 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 sd     1.03 </span></div><div class="line"><span class="comment">#&gt;  8 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 min   27.8  </span></div><div class="line"><span class="comment">#&gt;  9 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 max   30.6  </span></div><div class="line"><span class="comment">#&gt; 10 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700   30.6 medi~ 29.1  </span></div><div class="line"><span class="comment">#&gt; # ... with 5,010 more rows</span></div></pre></td></tr></table></figure>
<h3 id="创建tbl-time对象"><a href="#创建tbl-time对象" class="headerlink" title="创建tbl_time对象"></a>创建<code>tbl_time</code>对象</h3><blockquote>
<p><code>create_series()</code>函数</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 创建一整年的数据，每2天为一个间隔</span></div><div class="line">create_series(~<span class="string">'2013'</span>, period = <span class="string">'2 day'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 183 x 1</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    date               </div><div class="line">#&gt;    &lt;dttm&gt;             </div><div class="line">#&gt;  1 2013-01-01 00:00:00</div><div class="line">#&gt;  2 2013-01-03 00:00:00</div><div class="line">#&gt;  3 2013-01-05 00:00:00</div><div class="line">#&gt;  4 2013-01-07 00:00:00</div><div class="line">#&gt;  5 2013-01-09 00:00:00</div><div class="line">#&gt;  6 2013-01-11 00:00:00</div><div class="line">#&gt;  7 2013-01-13 00:00:00</div><div class="line">#&gt;  8 2013-01-15 00:00:00</div><div class="line">#&gt;  9 2013-01-17 00:00:00</div><div class="line">#&gt; 10 2013-01-19 00:00:00</div><div class="line">#&gt; # ... with 173 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 2013年的日度数据</span></div><div class="line">create_series(~<span class="string">'2013'</span>, period = <span class="string">'daily'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 365 x 1</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    date               </div><div class="line">#&gt;    &lt;dttm&gt;             </div><div class="line">#&gt;  1 2013-01-01 00:00:00</div><div class="line">#&gt;  2 2013-01-02 00:00:00</div><div class="line">#&gt;  3 2013-01-03 00:00:00</div><div class="line">#&gt;  4 2013-01-04 00:00:00</div><div class="line">#&gt;  5 2013-01-05 00:00:00</div><div class="line">#&gt;  6 2013-01-06 00:00:00</div><div class="line">#&gt;  7 2013-01-07 00:00:00</div><div class="line">#&gt;  8 2013-01-08 00:00:00</div><div class="line">#&gt;  9 2013-01-09 00:00:00</div><div class="line">#&gt; 10 2013-01-10 00:00:00</div><div class="line">#&gt; # ... with 355 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 2013年的季度数据</span></div><div class="line">create_series(~<span class="string">'2013'</span>, period = <span class="string">'1 quarter'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 4 x 1</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;   date               </div><div class="line">#&gt;   &lt;dttm&gt;             </div><div class="line">#&gt; 1 2013-01-01 00:00:00</div><div class="line">#&gt; 2 2013-04-01 00:00:00</div><div class="line">#&gt; 3 2013-07-01 00:00:00</div><div class="line">#&gt; 4 2013-10-01 00:00:00</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 2013年至2015年的季度数据</span></div><div class="line">create_series(<span class="string">'2013'</span> ~ <span class="string">'2015'</span>, period = <span class="string">'1 day'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 1,095 x 1</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    date               </div><div class="line">#&gt;    &lt;dttm&gt;             </div><div class="line">#&gt;  1 2013-01-01 00:00:00</div><div class="line">#&gt;  2 2013-01-02 00:00:00</div><div class="line">#&gt;  3 2013-01-03 00:00:00</div><div class="line">#&gt;  4 2013-01-04 00:00:00</div><div class="line">#&gt;  5 2013-01-05 00:00:00</div><div class="line">#&gt;  6 2013-01-06 00:00:00</div><div class="line">#&gt;  7 2013-01-07 00:00:00</div><div class="line">#&gt;  8 2013-01-08 00:00:00</div><div class="line">#&gt;  9 2013-01-09 00:00:00</div><div class="line">#&gt; 10 2013-01-10 00:00:00</div><div class="line">#&gt; # ... with 1,085 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 2012年1月至2012年2月每分钟的高频数据</span></div><div class="line">create_series(<span class="string">'2012-01'</span> ~ <span class="string">'2012-02'</span>, period = <span class="string">'1 minute'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 86,400 x 1</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    date               </div><div class="line">#&gt;    &lt;dttm&gt;             </div><div class="line">#&gt;  1 2012-01-01 00:00:00</div><div class="line">#&gt;  2 2012-01-01 00:01:00</div><div class="line">#&gt;  3 2012-01-01 00:02:00</div><div class="line">#&gt;  4 2012-01-01 00:03:00</div><div class="line">#&gt;  5 2012-01-01 00:04:00</div><div class="line">#&gt;  6 2012-01-01 00:05:00</div><div class="line">#&gt;  7 2012-01-01 00:06:00</div><div class="line">#&gt;  8 2012-01-01 00:07:00</div><div class="line">#&gt;  9 2012-01-01 00:08:00</div><div class="line">#&gt; 10 2012-01-01 00:09:00</div><div class="line">#&gt; # ... with 86,390 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 2011年1月1日每秒钟的高频数据</span></div><div class="line">create_series(<span class="string">'2011-01-01 12:10:00'</span> ~ <span class="string">'2011-01-01 12:12:00'</span>, period = <span class="string">'1 second'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 121 x 1</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    date               </div><div class="line">#&gt;    &lt;dttm&gt;             </div><div class="line">#&gt;  1 2011-01-01 12:10:00</div><div class="line">#&gt;  2 2011-01-01 12:10:01</div><div class="line">#&gt;  3 2011-01-01 12:10:02</div><div class="line">#&gt;  4 2011-01-01 12:10:03</div><div class="line">#&gt;  5 2011-01-01 12:10:04</div><div class="line">#&gt;  6 2011-01-01 12:10:05</div><div class="line">#&gt;  7 2011-01-01 12:10:06</div><div class="line">#&gt;  8 2011-01-01 12:10:07</div><div class="line">#&gt;  9 2011-01-01 12:10:08</div><div class="line">#&gt; 10 2011-01-01 12:10:09</div><div class="line">#&gt; # ... with 111 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 创建类型为`Date`的序列</span></div><div class="line">create_series(~<span class="string">'2013'</span>, period = <span class="string">'1 day'</span>, class = <span class="string">"Date"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 365 x 1</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    date      </div><div class="line">#&gt;    &lt;date&gt;    </div><div class="line">#&gt;  1 2013-01-01</div><div class="line">#&gt;  2 2013-01-02</div><div class="line">#&gt;  3 2013-01-03</div><div class="line">#&gt;  4 2013-01-04</div><div class="line">#&gt;  5 2013-01-05</div><div class="line">#&gt;  6 2013-01-06</div><div class="line">#&gt;  7 2013-01-07</div><div class="line">#&gt;  8 2013-01-08</div><div class="line">#&gt;  9 2013-01-09</div><div class="line">#&gt; 10 2013-01-10</div><div class="line">#&gt; # ... with 355 more rows</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 创建类型为`yearmon`的序列</span></div><div class="line">create_series(~<span class="string">'2013'</span>, period = <span class="string">'1 month'</span>, class = <span class="string">"yearmon"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 12 x 1</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    date         </div><div class="line">#&gt;    &lt;S3: yearmon&gt;</div><div class="line">#&gt;  1 1月 2013     </div><div class="line">#&gt;  2 2月 2013     </div><div class="line">#&gt;  3 3月 2013     </div><div class="line">#&gt;  4 4月 2013     </div><div class="line">#&gt;  5 5月 2013     </div><div class="line">#&gt;  6 6月 2013     </div><div class="line">#&gt;  7 7月 2013     </div><div class="line">#&gt;  8 8月 2013     </div><div class="line">#&gt;  9 9月 2013     </div><div class="line">#&gt; 10 10月 2013    </div><div class="line">#&gt; 11 11月 2013    </div><div class="line">#&gt; 12 12月 2013</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 创建类型为`hms`的序列</span></div><div class="line"><span class="comment"># `time_formula`的格式为`HH:MM:SS`</span></div><div class="line">create_series(time_formula = <span class="string">'00:00:00'</span> ~ <span class="string">'12:00:00'</span>, period = <span class="string">'1 second'</span> , class = <span class="string">"hms"</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 43,201 x 1</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    date  </div><div class="line">#&gt;    &lt;time&gt;</div><div class="line">#&gt;  1 00&apos;00&quot;</div><div class="line">#&gt;  2 00&apos;01&quot;</div><div class="line">#&gt;  3 00&apos;02&quot;</div><div class="line">#&gt;  4 00&apos;03&quot;</div><div class="line">#&gt;  5 00&apos;04&quot;</div><div class="line">#&gt;  6 00&apos;05&quot;</div><div class="line">#&gt;  7 00&apos;06&quot;</div><div class="line">#&gt;  8 00&apos;07&quot;</div><div class="line">#&gt;  9 00&apos;08&quot;</div><div class="line">#&gt; 10 00&apos;09&quot;</div><div class="line">#&gt; # ... with 43,191 more rows</div></pre></td></tr></table></figure>
<h3 id="分组操作"><a href="#分组操作" class="headerlink" title="分组操作"></a>分组操作</h3><blockquote>
<p><code>collapse_index()</code>函数</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">collapse_index</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#&gt; function (index, period = &quot;yearly&quot;, start_date = NULL, side = &quot;end&quot;, </div><div class="line">#&gt;     ...) </div><div class="line">#&gt; &#123;</div><div class="line">#&gt;     index_part &lt;- partition_index(index, period, start_date)</div><div class="line">#&gt;     index_num &lt;- to_posixct_numeric(index)</div><div class="line">#&gt;     if (side == &quot;start&quot;) &#123;</div><div class="line">#&gt;         pos &lt;- match(unique(index_part), index_part)</div><div class="line">#&gt;         index_at_pos &lt;- index_num[pos]</div><div class="line">#&gt;         reps &lt;- diff(c(pos, length(index_part) + 1))</div><div class="line">#&gt;     &#125;</div><div class="line">#&gt;     else if (side == &quot;end&quot;) &#123;</div><div class="line">#&gt;         pos &lt;- length(index_part) - match(unique(index_part), </div><div class="line">#&gt;             rev(index_part)) + 1</div><div class="line">#&gt;         index_at_pos &lt;- index_num[pos]</div><div class="line">#&gt;         reps &lt;- diff(c(0, pos))</div><div class="line">#&gt;     &#125;</div><div class="line">#&gt;     new_index &lt;- posixct_numeric_to_datetime(x = rep(index_at_pos, </div><div class="line">#&gt;         reps), class = get_index_col_class(index), tz = get_index_col_time_zone(index))</div><div class="line">#&gt;     new_index</div><div class="line">#&gt; &#125;</div><div class="line">#&gt; &lt;environment: namespace:tibbletime&gt;</div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 计算每个月的均值</span></div><div class="line">FB_tbl_time %&gt;%</div><div class="line">  select(-symbol) %&gt;%</div><div class="line">  mutate(date = collapse_index(index = date, period = <span class="string">"monthly"</span>, side = <span class="string">"end"</span>)) %&gt;%</div><div class="line">  group_by(date) %&gt;%</div><div class="line">  summarise_all(mean)</div><div class="line"><span class="comment">#&gt; # A time tibble: 48 x 7</span></div><div class="line"><span class="comment">#&gt; # Index: date</span></div><div class="line"><span class="comment">#&gt;    date        open  high   low close   volume adjusted</span></div><div class="line"><span class="comment">#&gt;    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 2013-01-31  30.2  30.8  29.8  30.3 79802462     30.3</span></div><div class="line"><span class="comment">#&gt;  2 2013-02-28  28.3  28.6  27.7  28.1 50402095     28.1</span></div><div class="line"><span class="comment">#&gt;  3 2013-03-28  26.9  27.2  26.5  26.8 36359025     26.8</span></div><div class="line"><span class="comment">#&gt;  4 2013-04-30  26.6  27.0  26.2  26.6 33568600     26.6</span></div><div class="line"><span class="comment">#&gt;  5 2013-05-31  26.4  26.6  25.9  26.1 44640673     26.1</span></div><div class="line"><span class="comment">#&gt;  6 2013-06-28  24.0  24.3  23.7  23.9 39416575     23.9</span></div><div class="line"><span class="comment">#&gt;  7 2013-07-31  27.7  28.2  27.4  27.9 65364414     27.9</span></div><div class="line"><span class="comment">#&gt;  8 2013-08-30  38.7  39.3  38.2  38.7 61136095     38.7</span></div><div class="line"><span class="comment">#&gt;  9 2013-09-30  45.5  46.3  44.9  45.8 79154190     45.8</span></div><div class="line"><span class="comment">#&gt; 10 2013-10-31  50.7  51.5  49.7  50.5 88375435     50.5</span></div><div class="line"><span class="comment">#&gt; # ... with 38 more rows</span></div><div class="line"><span class="comment"># 等同于</span></div><div class="line">FB_tbl_time %&gt;%</div><div class="line">  select(-symbol) %&gt;%</div><div class="line">  mutate(date = collapse_index(index = date, period = <span class="string">"1 month"</span>, side = <span class="string">"end"</span>)) %&gt;%</div><div class="line">  group_by(date) %&gt;%</div><div class="line">  summarise_all(mean)</div><div class="line"><span class="comment">#&gt; # A time tibble: 48 x 7</span></div><div class="line"><span class="comment">#&gt; # Index: date</span></div><div class="line"><span class="comment">#&gt;    date        open  high   low close   volume adjusted</span></div><div class="line"><span class="comment">#&gt;    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 2013-01-31  30.2  30.8  29.8  30.3 79802462     30.3</span></div><div class="line"><span class="comment">#&gt;  2 2013-02-28  28.3  28.6  27.7  28.1 50402095     28.1</span></div><div class="line"><span class="comment">#&gt;  3 2013-03-28  26.9  27.2  26.5  26.8 36359025     26.8</span></div><div class="line"><span class="comment">#&gt;  4 2013-04-30  26.6  27.0  26.2  26.6 33568600     26.6</span></div><div class="line"><span class="comment">#&gt;  5 2013-05-31  26.4  26.6  25.9  26.1 44640673     26.1</span></div><div class="line"><span class="comment">#&gt;  6 2013-06-28  24.0  24.3  23.7  23.9 39416575     23.9</span></div><div class="line"><span class="comment">#&gt;  7 2013-07-31  27.7  28.2  27.4  27.9 65364414     27.9</span></div><div class="line"><span class="comment">#&gt;  8 2013-08-30  38.7  39.3  38.2  38.7 61136095     38.7</span></div><div class="line"><span class="comment">#&gt;  9 2013-09-30  45.5  46.3  44.9  45.8 79154190     45.8</span></div><div class="line"><span class="comment">#&gt; 10 2013-10-31  50.7  51.5  49.7  50.5 88375435     50.5</span></div><div class="line"><span class="comment">#&gt; # ... with 38 more rows</span></div></pre></td></tr></table></figure>
<p>来看下<code>collpase_index()</code>函数究竟做了什么：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">FB_tbl_time %&gt;%</div><div class="line">  select(-symbol) %&gt;%</div><div class="line">  <span class="comment"># 这里side = "start"/"end"，前者是该时间区间的第一个数，后者是最后一个数</span></div><div class="line">  mutate(date = collapse_index(index = date, period = <span class="string">"monthly"</span>, side = <span class="string">"end"</span>))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#&gt; # A time tibble: 1,008 x 7</div><div class="line">#&gt; # Index: date</div><div class="line">#&gt;    date        open  high   low close    volume adjusted</div><div class="line">#&gt;    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</div><div class="line">#&gt;  1 2013-01-31  27.4  28.2  27.4  28.0  69846400     28.0</div><div class="line">#&gt;  2 2013-01-31  27.9  28.5  27.6  27.8  63140600     27.8</div><div class="line">#&gt;  3 2013-01-31  28.0  28.9  27.8  28.8  72715400     28.8</div><div class="line">#&gt;  4 2013-01-31  28.7  29.8  28.6  29.4  83781800     29.4</div><div class="line">#&gt;  5 2013-01-31  29.5  29.6  28.9  29.1  45871300     29.1</div><div class="line">#&gt;  6 2013-01-31  29.7  30.6  29.5  30.6 104787700     30.6</div><div class="line">#&gt;  7 2013-01-31  30.6  31.5  30.3  31.3  95316400     31.3</div><div class="line">#&gt;  8 2013-01-31  31.3  32.0  31.1  31.7  89598000     31.7</div><div class="line">#&gt;  9 2013-01-31  32.1  32.2  30.6  31.0  98892800     31.0</div><div class="line">#&gt; 10 2013-01-31  30.6  31.7  29.9  30.1 173242600     30.1</div><div class="line">#&gt; # ... with 998 more rows</div></pre></td></tr></table></figure>
<p>很明显，<code>collpase_index()</code>函数创建了一个同<code>FB_tbl_time</code>行数相同的时间列，然后<code>dplyr</code>中的<code>group_by()</code>函数根据<br>这一列进行分组，最后通过聚合函数<code>mean()</code>计算每个月的均值。</p>
<p>再看一个例子</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Facebook, Amazon, Netflix and Google stocks</span></div><div class="line">data(FANG)</div><div class="line">FANG</div><div class="line"><span class="comment">#&gt; # A tibble: 4,032 x 8</span></div><div class="line"><span class="comment">#&gt;    symbol date        open  high   low close    volume adjusted</span></div><div class="line"><span class="comment">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0</span></div><div class="line"><span class="comment">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8</span></div><div class="line"><span class="comment">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8</span></div><div class="line"><span class="comment">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4</span></div><div class="line"><span class="comment">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1</span></div><div class="line"><span class="comment">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6</span></div><div class="line"><span class="comment">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3</span></div><div class="line"><span class="comment">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7</span></div><div class="line"><span class="comment">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0</span></div><div class="line"><span class="comment">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1</span></div><div class="line"><span class="comment">#&gt; # ... with 4,022 more rows</span></div><div class="line"></div><div class="line"><span class="comment"># 根据时间索引列和股票代码分组</span></div><div class="line">FANG %&gt;% </div><div class="line">  as_tbl_time(date) %&gt;%</div><div class="line">  group_by(symbol) %&gt;%</div><div class="line">  </div><div class="line">  <span class="comment"># 日度数据转化为年度数据</span></div><div class="line">  mutate(date = collapse_index(date, period = <span class="string">"yearly"</span>)) %&gt;%</div><div class="line">  </div><div class="line">  <span class="comment"># Additionally group by date (yearly)</span></div><div class="line">  group_by(date, add = <span class="literal">TRUE</span>) %&gt;%</div><div class="line">  </div><div class="line">  <span class="comment"># Perform a yearly summary for each symbol</span></div><div class="line">  summarise(</div><div class="line">    adj_min   = min(adjusted),</div><div class="line">    adj_max   = max(adjusted),</div><div class="line">    adj_range = adj_max - adj_min</div><div class="line">  )</div><div class="line"><span class="comment">#&gt; # A time tibble: 16 x 5</span></div><div class="line"><span class="comment">#&gt; # Index:  date</span></div><div class="line"><span class="comment">#&gt; # Groups: symbol [?]</span></div><div class="line"><span class="comment">#&gt;    symbol date       adj_min adj_max adj_range</span></div><div class="line"><span class="comment">#&gt;    &lt;chr&gt;  &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span></div><div class="line"><span class="comment">#&gt;  1 AMZN   2013-12-31   248     404       156  </span></div><div class="line"><span class="comment">#&gt;  2 AMZN   2014-12-31   287     407       120  </span></div><div class="line"><span class="comment">#&gt;  3 AMZN   2015-12-31   287     694       407  </span></div><div class="line"><span class="comment">#&gt;  4 AMZN   2016-12-30   482     844       362  </span></div><div class="line"><span class="comment">#&gt;  5 FB     2013-12-31    22.9    58.0      35.1</span></div><div class="line"><span class="comment">#&gt;  6 FB     2014-12-31    53.5    81.4      27.9</span></div><div class="line"><span class="comment">#&gt;  7 FB     2015-12-31    74.1   109        35.0</span></div><div class="line"><span class="comment">#&gt;  8 FB     2016-12-30    94.2   133        39.1</span></div><div class="line"><span class="comment">#&gt;  9 GOOG   2013-12-31   351     560       209  </span></div><div class="line"><span class="comment">#&gt; 10 GOOG   2014-12-31   495     609       114  </span></div><div class="line"><span class="comment">#&gt; 11 GOOG   2015-12-31   493     777       284  </span></div><div class="line"><span class="comment">#&gt; 12 GOOG   2016-12-30   668     813       145  </span></div><div class="line"><span class="comment">#&gt; 13 NFLX   2013-12-31    13.1    54.4      41.2</span></div><div class="line"><span class="comment">#&gt; 14 NFLX   2014-12-31    44.9    69.2      24.3</span></div><div class="line"><span class="comment">#&gt; 15 NFLX   2015-12-31    45.5   131        85.4</span></div><div class="line"><span class="comment">#&gt; 16 NFLX   2016-12-30    82.8   128        45.6</span></div></pre></td></tr></table></figure>
<h4 id="滚动回归"><a href="#滚动回归" class="headerlink" title="滚动回归"></a>滚动回归</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">data(<span class="string">"FB"</span>)</div><div class="line"></div><div class="line">rolling_lm &lt;- rollify(.f = <span class="keyword">function</span>(close, high, low, volume) &#123;</div><div class="line">                              lm(close ~ high + low + volume)</div><div class="line">                           &#125;, </div><div class="line">                      window = <span class="number">5</span>, </div><div class="line">                      unlist = <span class="literal">FALSE</span>)  <span class="comment"># 将回归结果存储为一个`S3`对象</span></div><div class="line"></div><div class="line">FB_reg &lt;- mutate(FB, roll_lm = rolling_lm(close, high, low, volume))</div><div class="line">FB_reg</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#&gt; # A tibble: 1,008 x 9</div><div class="line">#&gt;    symbol date        open  high   low close    volume adjusted roll_lm  </div><div class="line">#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;list&gt;   </div><div class="line">#&gt;  1 FB     2013-01-02  27.4  28.2  27.4  28.0  69846400     28.0 &lt;lgl [1]&gt;</div><div class="line">#&gt;  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8 &lt;lgl [1]&gt;</div><div class="line">#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8 &lt;lgl [1]&gt;</div><div class="line">#&gt;  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4 &lt;lgl [1]&gt;</div><div class="line">#&gt;  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1 &lt;S3: lm&gt; </div><div class="line">#&gt;  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6 &lt;S3: lm&gt; </div><div class="line">#&gt;  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3 &lt;S3: lm&gt; </div><div class="line">#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7 &lt;S3: lm&gt; </div><div class="line">#&gt;  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0 &lt;S3: lm&gt; </div><div class="line">#&gt; 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1 &lt;S3: lm&gt; </div><div class="line">#&gt; # ... with 998 more rows</div></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://business-science.github.io/tibbletime/index.html" target="_blank" rel="external">tibbletime</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/tibbletime/" rel="tag"># tibbletime</a>
          
            <a href="/tags/time-series/" rel="tag"># time series</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/29/一幅图告诉你为什么要学习R/" rel="next" title="一幅图告诉你，为什么要学R？">
                <i class="fa fa-chevron-left"></i> 一幅图告诉你，为什么要学R？
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/06/用-purrr-包批量读取xlsx数据并转化为一个数据框/" rel="prev" title="用`purrr`包批量读取xlsx数据并转化为一个数据框">
                用`purrr`包批量读取xlsx数据并转化为一个数据框 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Leo Lee" />
            
              <p class="site-author-name" itemprop="name">Leo Lee</p>
              <p class="site-description motion-element" itemprop="description">Leo Lee的个人小站</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/Leo-Lee15" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:lgz1993leo@gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.instagram.com/leeleo93" target="_blank" title="Instagram">
                    
                      <i class="fa fa-fw fa-instagram"></i></a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#tibbletime操作"><span class="nav-number">1.</span> <span class="nav-text">tibbletime操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#将常规的数据框转化为tbl-time"><span class="nav-number">1.1.</span> <span class="nav-text">将常规的数据框转化为tbl_time</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对tbl-time对象切片"><span class="nav-number">1.2.</span> <span class="nav-text">对tbl_time对象切片</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#对分组后的tbl-time对象进行取子集操作"><span class="nav-number">1.2.1.</span> <span class="nav-text">对分组后的tbl_time对象进行取子集操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#根据分钟-秒来提取子集"><span class="nav-number">1.2.2.</span> <span class="nav-text">根据分钟/秒来提取子集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#利用filter-time-函数进行编程"><span class="nav-number">1.2.3.</span> <span class="nav-text">利用filter_time()函数进行编程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对tbl-time对象进行高频转低频"><span class="nav-number">1.3.</span> <span class="nav-text">对tbl_time对象进行高频转低频</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#滚动计算"><span class="nav-number">1.4.</span> <span class="nav-text">滚动计算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建tbl-time对象"><span class="nav-number">1.5.</span> <span class="nav-text">创建tbl_time对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分组操作"><span class="nav-number">1.6.</span> <span class="nav-text">分组操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#滚动回归"><span class="nav-number">1.6.1.</span> <span class="nav-text">滚动回归</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">2.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leo Lee</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
